<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Project 3: Panoramas and Homographies | CS180</title>
	<link rel="stylesheet" href="styles.css" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<!-- KaTeX for math rendering in A.2 -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
	<style>
		/* Lightweight additions to complement styles.css */
		* { box-sizing: border-box; }
		/* Let content size naturally; don't hide horizontal overflow globally (prevents grids being cut off) */
		body { max-width: 1200px; margin: 0 auto; }
		header.page-header { padding: 1.25rem 0; border-bottom: 1px solid #e5e7eb; }
		.nav-bar { display:flex; gap:.5rem; align-items:center; margin:.5rem 0 1rem; }
		.nav-bar a { padding:.35rem .6rem; border:1px solid #e5e7eb; border-radius:6px; text-decoration:none; color:#111; background:#fafafa; }
		.layout { display:grid; grid-template-columns: 240px 1fr; gap: 1.25rem; }
		@media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }
		aside.toc { position: sticky; top: 0.75rem; align-self: start; border:1px solid #e5e7eb; border-radius:10px; padding:0.75rem; background:#fff; }
		aside.toc h3 { margin-top:0; font-size:1rem; }
		aside.toc ul { list-style:none; padding-left:0; margin:0; }
		aside.toc li { margin:.35rem 0; }
		main section { margin-bottom: 2.25rem; }
		h2 { border-bottom: 1px solid #e5e7eb; padding-bottom:.25rem; }
		.grid { display:grid; gap: .75rem; }
		.grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
		.grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
		.grid.cols-4 { grid-template-columns: repeat(4, 1fr); }
		/* Responsive breakpoints so grids resize instead of overflowing */
		@media (max-width: 900px) {
			.grid.cols-4 { grid-template-columns: repeat(2, 1fr); }
			.grid.cols-3 { grid-template-columns: repeat(2, 1fr); }
		}
		@media (max-width: 600px) {
			.grid.cols-4,
			.grid.cols-3,
			.grid.cols-2 { grid-template-columns: 1fr; }
		}
		figure { margin:0; }
		figure img { width: 100%; height: auto; border-radius: 8px; cursor: zoom-in; box-shadow: 0 1px 3px rgba(0,0,0,.12); display:block; object-fit: contain; }
		figure figcaption { font-size: .9rem; color: #555; margin-top: .35rem; }
		/* Lightbox / modal */
		.lightbox-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index: 1000; padding: 2vh 2vw; overflow:auto; }
		.lightbox-overlay.open { display:flex; }
		.lightbox-content { position:relative; max-width: 100%; max-height: 100%; }
		.lightbox-content img { display:block; max-width: min(96vw, 1400px); max-height: 96vh; width:auto; height:auto; object-fit: contain; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.35); cursor: zoom-out; }
		.lightbox-close { position:absolute; top:.75rem; right:.75rem; background: rgba(255,255,255,.95); border:none; border-radius:999px; width:36px; height:36px; cursor:pointer; font-size:18px; box-shadow: 0 2px 6px rgba(0,0,0,.25); }
		.katex-block { margin: .75rem 0; }
		/* Ensure wide equations don't force page-wide overflow */
		.katex-display { max-width: 100%; overflow-x: auto; overflow-y: hidden; }
		.katex-display > .katex { white-space: nowrap; }
		.badge { display:inline-block; font-size:.8rem; padding:.15rem .4rem; border:1px solid #e5e7eb; border-radius:6px; background:#fafafa; }
        /* Styles for code blocks */
        pre {
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-x: auto;
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        code {
            font-family: 'Courier New', monospace;
        }
	</style>
</head>
<body>
	<header>
		<div class="container">
			<div class="header-content">
				<a href="index.html" class="back-button" aria-label="Back to portfolio">
					<i class="fas fa-arrow-left"></i>
				</a>
				<div class="header-info">
					<div class="project-icon"><i class="fas fa-wave-square"></i></div>
					<div>
						<h1 class="project-title">Project 3: Panoramas and Homographies</h1>
						<p class="project-course">CS180 â€¢ Fall 2025</p>
					</div>
				</div>
			</div>
		</div>
	</header>

	<div class="layout">
		<aside class="toc">
			<h3>Contents</h3>
			<ul>
				<li><a href="#a1">A.1 Pictures</a></li>
				<li><a href="#a2">A.2 Recover Homographies</a></li>
				<li><a href="#a3">A.3 Rectification (NN vs Bilinear)</a></li>
				<li><a href="#a4">A.4 Mosaics (weighted blending)</a></li>
				<li><span class="badge">Part B (later)</span></li>
			</ul>
		</aside>

		<main>
			<section id="a1">
				<h2>A.1 Two pairs of images with a camera rotation</h2>
				<div class="grid cols-2">
					<figure>
						<img class="lb" src="proj3/IMG_5597.jpg" alt="Room Facing Down" />
						<figcaption>Room Facing Down</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/IMG_5598.jpg" alt="Room Facing Up" />
						<figcaption>Room Facing Up</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/IMG_5599.jpg" alt="Roof Left" />
						<figcaption>Roof Left</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/IMG_5600.jpg" alt="Roof Right" />
						<figcaption>Roof Right</figcaption>
					</figure>
				</div>
			</section>

			<section id="a2">
				<h2>A.2 Matches, equations, and homography</h2>
				<div class="grid cols-2">
                    <div>   
                        <figure>
                            <img class="lb" src="proj3/room_matches.png" alt="Manual correspondences between the room image pair" />
                            <figcaption>Manual correspondences between the room image pair.</figcaption>
                        </figure>
                        <div style="margin-top:1rem;">
                            <h3>Recovered homography for the shown pair</h3>
            
                            <pre id="homography-matrix"><code> array([[ 7.13986118e-01, -5.96434567e-01,  2.81016189e+02],
                                                                    [-3.25037133e-03,  9.14168978e-02,  7.61972838e+02],
                                                                    [-5.20929674e-06, -5.91647402e-04,  1.00000000e+00]]) </code></pre>
                        </div>
                    </div>
					<div>
						<h3>Linear system for H</h3>
						<p>Given correspondences $(x_i, y_i) \mapsto (x'_i, y'_i)$, we solve for $\mathbf{h}$ such that $\mathbf{A}\,\mathbf{h} = \mathbf{0}$ where each point contributes:</p>
						<div class="katex-block">$$
						\begin{bmatrix}
							-x_i & -y_i & -1 & 0 & 0 & 0 & x_i x'_i & y_i x'_i & x'_i \\
							0 & 0 & 0 & -x_i & -y_i & -1 & x_i y'_i & y_i y'_i & y'_i
						\end{bmatrix}
						\begin{bmatrix}
							h_{11}\\ h_{12}\\ h_{13}\\ h_{21}\\ h_{22}\\ h_{23}\\ h_{31}\\ h_{32}\\ h_{33}
						\end{bmatrix}
						= \mathbf{0}
						$$</div>
						<p>We recover $\mathbf{H}$ as the reshaped right singular vector of $\mathbf{A}$ with the smallest singular value (DLT). We also use Hartley normalization for stability.</p>
					</div>
				</div>
				
			</section>

			<section id="a3">
				<h2>A.3 Rectification: Nearest-Neighbors vs Bilinear</h2>
				<p>We apply inverse homography to the original images to obtain rectified views. The NN interpolation tends to produce jagged artifacts, while bilinear interpolation results in smoother images, although it takes longer to compute.</p>
				<div class="grid cols-3">
					<figure>
						<img class="lb" src="proj3/IMG_5605.jpg" alt="Laptop (Original)" />
						<figcaption>Laptop (Original)</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/laptop_warped_nearest.png" alt="Laptop Rectified (Nearest)" />
						<figcaption>Laptop Rectified (Nearest)</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/laptop_warped_bilinear.png" alt="Laptop Rectified (Bilinear)" />
						<figcaption>Laptop Rectified (Bilinear)</figcaption>
					</figure>

					<figure>
						<img class="lb" src="proj3/IMG_5606.jpg" alt="Poster (Original)" />
						<figcaption>Poster (Original)</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/poster_warped_nearest.png" alt="Poster Rectified (Nearest)" />
						<figcaption>Poster Rectified (Nearest)</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/poster_warped_bilinear.png" alt="Poster Rectified (Bilinear)" />
						<figcaption>Poster Rectified (Bilinear)</figcaption>
					</figure>
				</div>
			</section>

			<section id="a4">
				<h2>A.4 Mosaics (weighted averaging)</h2>
				<p>The procedure involves first aligning the images by manually selecting keypoints and computing the homographies. Then, we inverse warp one image into the coordinate space of the other and blend them by converting binary masks to soft masks through feathering.</p>
				<div class="grid cols-3">
					<figure>
						<img class="lb" src="proj3/IMG_5597.jpg" alt="Room Facing Down" />
						<figcaption>Room Facing Down</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/IMG_5598.jpg" alt="Room Facing Up" />
						<figcaption>Room Facing Up</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/mosaic_room_cropped.png" alt="Room mosaic" />
						<figcaption>Room Mosaic</figcaption>
					</figure>

					<figure>
						<img class="lb" src="proj3/IMG_5599.jpg" alt="Roof left" />
						<figcaption>Roof Left</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/IMG_5600.jpg" alt="Roof right" />
						<figcaption>Roof Right</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/mosaic_roof.png" alt="Roof mosaic" />
						<figcaption>Roof Mosaic</figcaption>
					</figure>

					<figure>
						<img class="lb" src="proj3/IMG_5608.jpg" alt="Third pair left (placeholder)" />
						<figcaption>Courtyard Left</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/IMG_5609.jpg" alt="Third pair right (placeholder)" />
						<figcaption>Courtyard Right</figcaption>
					</figure>
					<figure>
						<img class="lb" src="proj3/mosaic_physics.png" alt="Third mosaic (placeholder)" />
						<figcaption>Courtyard Mosaic</figcaption>
					</figure>
				</div>
			</section>
		</main>
	</div>

	<!-- Lightbox modal root -->
	<div id="lightbox" class="lightbox-overlay" aria-hidden="true">
		<div class="lightbox-content" role="dialog" aria-modal="true" aria-label="Image preview">
			<button class="lightbox-close" aria-label="Close">&times;</button>
			<img id="lightbox-img" src="" alt="Expanded image" />
		</div>
	</div>

	<script>
		// Simple lightbox: click .lb images to open; click outside, close button, or ESC to dismiss
		(function(){
			const overlay = document.getElementById('lightbox');
			const imgEl = document.getElementById('lightbox-img');
			const closeBtn = overlay.querySelector('.lightbox-close');

			function openLightbox(src) {
				imgEl.src = src;
				overlay.classList.add('open');
				overlay.setAttribute('aria-hidden', 'false');
			}
			function closeLightbox(){
				overlay.classList.remove('open');
				overlay.setAttribute('aria-hidden', 'true');
				imgEl.src = '';
			}

			document.addEventListener('click', (e) => {
				const t = e.target;
				if (t && t.matches('img.lb')) {
					const full = t.getAttribute('data-full') || t.getAttribute('src');
					e.preventDefault();
					openLightbox(full);
				}
			});
			overlay.addEventListener('click', (e) => {
				// Close if clicked outside the image or on the close button
				if (e.target === overlay || e.target === closeBtn) closeLightbox();
			});
			document.addEventListener('keydown', (e) => {
				if (e.key === 'Escape') closeLightbox();
			});
		})();
	</script>

	<!-- Ensure KaTeX auto-render runs after DOM and scripts are ready -->
	<script>
	(function(){
		function renderKatex() {
			if (window.renderMathInElement) {
				renderMathInElement(document.body, {
					delimiters: [
						{ left: '$$', right: '$$', display: true },
						{ left: '$', right: '$', display: false }
					],
					throwOnError: false
				});
			}
		}
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', renderKatex);
		} else {
			renderKatex();
		}
	})();
	</script>
</body>
</html>

