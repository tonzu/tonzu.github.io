<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1: Colorizing the Prokudin-Gorskii Collection | CS180</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <div class="header-info">
                    <div class="project-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div>
                        <h1 class="project-title">Project 1: Colorizing the Prokudin-Gorskii Collection</h1>
                        <p class="project-course">CS180 â€¢ Fall 2025</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="content-card">
                <div class="due-date">
                    <div class="due-badge">
                        Due: September 12, 2025 at 11:59PM
                    </div>
                </div>

                <section>
                    <h2>Overview</h2>
                    <p>
                        The goal of this assignment is to take the digitized glass plate images and automatically produce color images with minimal artifacts. Each digitized plate contains three exposures stacked vertically in <strong>BGR order</strong> (blue at top, green in middle, red at bottom). The challenge is to extract these three color channels, align them properly, and combine them into a single RGB color image.
                    </p>
                </section>

                <section>
                    <h2>Approach</h2>
                    <p>
                        My algorithm follows these key steps:
                    </p>
                    <ol style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                        <li style="margin-bottom: 0.5rem;"><strong>Split the image</strong> into three equal parts (B, G, R from top to bottom)</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Use the green channel as reference</strong> and align blue and red channels to it</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Search for best alignment</strong> using normalized cross-correlation (NCC) as the similarity metric</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Apply pyramid search</strong> for large images to handle big displacements efficiently</li>
                    </ol>
                    
                    <p>
                        For alignment scoring, I use <strong>Normalized Cross-Correlation (NCC)</strong>, which works better than L2 norm for images with different brightness values. To avoid edge artifacts during alignment, I crop a small border from each channel before computing the similarity metric, focusing the search on the interior content where channels should match well.
                    </p>
                </section>

                <section>
                    <h2>Single-Scale Alignment</h2>
                    <p>
                        For small <code>.jpg</code> images, I use exhaustive search over a window of possible displacements ([-15, 15] pixels in both x and y directions). Each displacement is scored using NCC, and the best scoring displacement is selected.
                    </p>
                    
                    <h3>Results on Small Images</h3>
                    <div class="image-grid cols-2">
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_cathedral.png" alt="cathedral.jpg result" class="image-box" />
                            <h3 class="image-caption">cathedral.jpg</h3>
                            <div class="offset-display">
                                B displacement: (-5, -2)<br>
                                R displacement: (7, 1)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_monastery.png" alt="monastery.jpg result" class="image-box" />
                            <h3 class="image-caption">monastery.jpg</h3>
                            <div class="offset-display">
                                B displacement: (3, -2)<br>
                                R displacement: (6, 1)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_tobolsk.png" alt="tobolsk.jpg result" class="image-box" />
                            <h3 class="image-caption">tobolsk.jpg</h3>
                            <div class="offset-display">
                                B displacement: (-3, -3)<br>
                                R displacement: (4, 1)
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <h2>Pyramid Alignment</h2>
                    <p>
                        For large <code>.tif</code> images, exhaustive search becomes too slow. I implemented a coarse-to-fine pyramid approach:
                    </p>
                    <ol style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                        <li style="margin-bottom: 0.5rem;">Downsample the image into multiple levels (pyramid)</li>
                        <li style="margin-bottom: 0.5rem;">Start alignment at the coarsest (smallest) level</li>
                        <li style="margin-bottom: 0.5rem;">Refine the displacement estimate at each finer level</li>
                        <li style="margin-bottom: 0.5rem;">Use a smaller search window at each level for efficiency</li>
                    </ol>
                    <p>
                        This approach dramatically reduces computation time while maintaining alignment accuracy.
                    </p>
                    
                    <h3>Results on Large Images</h3>
                    <div class="image-grid cols-2">
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_church.png" alt="church.tif result" class="image-box" />
                            <h3 class="image-caption">church.tif</h3>
                            <div class="offset-display">
                                B: (-25, -4)<br>R: (33, -8)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_emir.png" alt="emir.tif result" class="image-box" />
                            <h3 class="image-caption">emir.tif</h3>
                            <div class="offset-display">
                                B: (-48, -24)<br>R: (57, 17)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_harvesters.png" alt="harvesters.tif result" class="image-box" />
                            <h3 class="image-caption">harvesters.tif</h3>
                            <div class="offset-display">
                                B: (-59, -17)<br>R: (64, -3)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_icon.png" alt="icon.tif result" class="image-box" />
                            <h3 class="image-caption">icon.tif</h3>
                            <div class="offset-display">
                                B: (-41, -18)<br>R: (49, 5)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_italil.png" alt="italil.tif result" class="image-box" />
                            <h3 class="image-caption">italil.tif</h3>
                            <div class="offset-display">
                                B: (-38, -21)<br>R: (39, 15)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_lastochikino.png" alt="lastochikino.tif result" class="image-box" />
                            <h3 class="image-caption">lastochikino.tif</h3>
                            <div class="offset-display">
                                B: (3, 2)<br>R: (78, -6)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_lugano.png" alt="lugano.tif result" class="image-box" />
                            <h3 class="image-caption">lugano.tif</h3>
                            <div class="offset-display">
                                B: (-41, 15)<br>R: (53, -13)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_melons.png" alt="melons.tif result" class="image-box" />
                            <h3 class="image-caption">melons.tif</h3>
                            <div class="offset-display">
                                B: (-84, -10)<br>R: (96, 3)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_self_portrait.png" alt="self_portrait.tif result" class="image-box" />
                            <h3 class="image-caption">self_portrait.tif</h3>
                            <div class="offset-display">
                                B: (-78, -29)<br>R: (98, 8)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_siren.png" alt="siren.tif result" class="image-box" />
                            <h3 class="image-caption">siren.tif</h3>
                            <div class="offset-display">
                                B: (-49, 5)<br>R: (47, -19)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_three_generations.png" alt="three_generations.tif result" class="image-box" />
                            <h3 class="image-caption">three_generations.tif</h3>
                            <div class="offset-display">
                                B: (-51, -14)<br>R: (59, -2)
                            </div>
                        </div>
                    </div>
<!-- 
                    <h3>Summary of Displacement Results</h3>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Blue Displacement (x, y)</th>
                                <th>Red Displacement (x, y)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>cathedral.jpg</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                            <tr>
                                <td>monastery.jpg</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                            <tr>
                                <td>church.tif</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                            <tr>
                                <td>emir.tif</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                            <tr>
                                <td>harvesters.tif</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                            <tr>
                                <td>icon.tif</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                            <tr>
                                <td>lady.tif</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                            <tr>
                                <td>melons.tif</td>
                                <td><code>( , )</code></td>
                                <td><code>( , )</code></td>
                            </tr>
                        </tbody>
                    </table> -->
                </section>

                <section>
                    <h2>Additional Examples from Collection</h2>
                    <p>
                        I also tested my algorithm on additional images from the Prokudin-Gorskii collection:
                    </p>
                    
                    <div class="image-grid cols-2">
                    <div class="image-grid cols-2">
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_capri.png" alt="capri.tif result" class="image-box" />
                            <h3 class="image-caption">capri.tif</h3>
                            <div class="offset-display">
                                B: (-31, 16)<br>R: (47, -9)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_haystack.png" alt="haystack.tif result" class="image-box" />
                            <h3 class="image-caption">haystack.tif</h3>
                            <div class="offset-display">
                                B: (92, 0)<br>R: (16, -9)
                            </div>
                        </div>
                        <div class="image-placeholder">
                            <img src="proj1/output_images/out_waterfall.png" alt="waterfall.tif result" class="image-box" />
                            <h3 class="image-caption">waterfall.tif</h3>
                            <div class="offset-display">
                                B: (-14, 2)<br>R: (67, -1)
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <h2>Problems Encountered</h2>
                    <p>
                        The main challenge was handling the edge artifacts that occur during alignment. Initial attempts using the full image for similarity computation led to poor results because the borders dominated the scoring function. The solution was to crop a margin before computing NCC, focusing the search on the interior content where channels should genuinely match. For the larger images, I stuck with an aggressive 30% border crop, which worked well across the board. This also helped to reduce the runtime. 
                    </p>
                    <p>
                        Even after most images became aligned, <code>emir.tif</code> was giving me a hard time. I tried playing with the parameters, and increasing the number of levels in the pyramid definitely helped, but the offset was still pretty far off even though I knew my functions were correct since everything else was fine. I then stumbled upon a tip to change the reference channel from blue to green. My understanding is that green was more aligned with the other two channels to begin with, so using it as reference made the search easier. After that, <code>emir.tif</code> finally worked, and I decided to stick with green as the reference channel for all images.
                    </p>

                </section>

            <!-- Navigation -->
            <div class="navigation">
                <a href="index.html" class="nav-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Portfolio
                </a>
                
                <div class="project-counter">
                    Project 1 of 5
                </div>
            </div>
        </div>
    </main>
</body>
</html>